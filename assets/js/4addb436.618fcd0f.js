"use strict";(self.webpackChunkreference_docs=self.webpackChunkreference_docs||[]).push([[44067],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),c=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=c(e.components);return r.createElement(u.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,f=p["".concat(u,".").concat(d)]||p[d]||h[d]||o;return n?r.createElement(f,s(s({ref:t},l),{},{components:n})):r.createElement(f,s({ref:t},l))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i[p]="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},17699:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const o={id:"auth",title:"Auth",description:"Supabase Edge Functions and Auth."},s=void 0,i={unversionedId:"guides/functions/auth",id:"guides/functions/auth",title:"Auth",description:"Supabase Edge Functions and Auth.",source:"@site/docs/guides/functions/auth.mdx",sourceDirName:"guides/functions",slug:"/guides/functions/auth",permalink:"/docs/guides/functions/auth",draft:!1,editUrl:"https://github.com/docs/guides/functions/auth.mdx",tags:[],version:"current",frontMatter:{id:"auth",title:"Auth",description:"Supabase Edge Functions and Auth."}},u={},c=[{value:"Auth Context &amp; RLS",id:"auth-context--rls",level:2}],l={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Edge Functions work seamlessly with ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/auth"},"Supabase Auth"),", allowing you to identify which user called your function."),(0,a.kt)("p",null,"When ",(0,a.kt)("a",{parentName:"p",href:"/docs/reference/javascript/invoke"},"invoking")," a function with one of the ",(0,a.kt)("a",{parentName:"p",href:"/docs/reference"},"client libraries"),", the logged in user's JWT is automatically attached to the function call and becomes accessible within your function."),(0,a.kt)("p",null,"This is important, for example, to identify which customer's credit card should be charged. You can see this concept end-to-end in our ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/supabase-community/expo-stripe-payments-with-supabase-functions"},"Stripe example app"),"."),(0,a.kt)("h2",{id:"auth-context--rls"},"Auth Context & RLS"),(0,a.kt)("p",null,"By creating a supabase client with the auth context from the function, you can do two things:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Get the user object."),(0,a.kt)("li",{parentName:"ol"},"Run queries in the context of the user with ",(0,a.kt)("a",{parentName:"li",href:"/docs/guides/auth/row-level-security"},"Row Level Security (RLS)")," policies enforced.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="supabase/functions/select-from-table-with-auth-rls/index.ts"',title:'"supabase/functions/select-from-table-with-auth-rls/index.ts"'},"import { serve } from 'https://deno.land/std@0.131.0/http/server.ts'\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2.0.0-rc.12'\n\nserve(async (req: Request) => {\n  try {\n    // Create a Supabase client with the Auth context of the logged in user.\n    const supabaseClient = createClient(\n      // Supabase API URL - env var exported by default.\n      Deno.env.get('SUPABASE_URL') ?? '',\n      // Supabase API ANON KEY - env var exported by default.\n      Deno.env.get('SUPABASE_ANON_KEY') ?? '',\n      // Create client with Auth context of the user that called the function.\n      // This way your row-level-security (RLS) policies are applied.\n      // highlight-next-line\n      { global: { headers: { Authorization: req.headers.get('Authorization')! } } }\n    )\n    // Now we can get the session or user object\n    // highlight-start\n    const {\n      data: { user },\n    } = await supabaseClient.auth.getUser()\n    // highlight-end\n\n    // And we can run queries in the context of our authenticated user\n    // highlight-start\n    const { data, error } = await supabaseClient.from('users').select('*')\n    if (error) throw error\n    // highlight-end\n\n    return new Response(JSON.stringify({ user, data }), {\n      headers: { 'Content-Type': 'application/json' },\n      status: 200,\n    })\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      headers: { 'Content-Type': 'application/json' },\n      status: 400,\n    })\n  }\n})\n")),(0,a.kt)("p",null,"See the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/supabase/supabase/blob/master/examples/edge-functions/supabase/functions/select-from-table-with-auth-rls/index.ts"},"example on GitHub"),"."))}p.isMDXComponent=!0}}]);