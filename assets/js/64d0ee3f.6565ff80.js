"use strict";(self.webpackChunkreference_docs=self.webpackChunkreference_docs||[]).push([[9226],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),h=a,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return n?r.createElement(m,o(o({ref:t},u),{},{components:n})):r.createElement(m,o({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},21e3:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(87462),a=(n(67294),n(3905));const i={},o=void 0,s={unversionedId:"guides/integrations/keyri",id:"guides/integrations/keyri",title:"keyri",description:"\u200b",source:"@site/docs/guides/integrations/keyri.mdx",sourceDirName:"guides/integrations",slug:"/guides/integrations/keyri",permalink:"/docs/guides/integrations/keyri",draft:!1,editUrl:"https://github.com/docs/guides/integrations/keyri.mdx",tags:[],version:"current",frontMatter:{}},l={},p=[{value:"description: &#39;QR authentication for an easy and flexible biometric solution across all platforms.&#39;",id:"description-qr-authentication-for-an-easy-and-flexible-biometric-solution-across-all-platforms",level:2},{value:"Install Flutter",id:"install-flutter",level:3},{value:"Apple - initial setup",id:"apple---initial-setup",level:3},{value:"Android - initial setup",id:"android---initial-setup",level:3},{value:"Create Project",id:"create-project",level:3},{value:"Add dependencies (Keyri and Supabase)",id:"add-dependencies-keyri-and-supabase",level:3},{value:"Utilize the two together",id:"utilize-the-two-together",level:3}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u200b\nid: keyri\ntitle: 'Keyri'"),(0,a.kt)("h2",{id:"description-qr-authentication-for-an-easy-and-flexible-biometric-solution-across-all-platforms"},"description: 'QR authentication for an easy and flexible biometric solution across all platforms.'"),(0,a.kt)("p",null,"\u200b\nKeyri can be used to incorporate sign-in-with-QR functionality into your Supabase app, allowing users to scan a QR code on your web app with your mobile app and be instantly logged into the web app without having to input any credentials.\n\u200b\nConfiguration is split into Web and Mobile components. On web, the Keyri QR Widget needs to be installed along with an event listener, and in your mobile app, install the Keyri SDK and pass into it the user's refresh token when sign-in-with-QR is initiated. When the refresh token lands in your web app, it's passed into Supabase's ",(0,a.kt)("inlineCode",{parentName:"p"},"setSession()")," method.\n\u200b"),(0,a.kt)("h1",{id:"sign-up-for-keyri"},"Sign up for Keyri"),(0,a.kt)("p",null,"\u200b\nFirst make a free account on the Keyri dashboard (",(0,a.kt)("a",{parentName:"p",href:"https://app.keyri.com"},"https://app.keyri.com"),"). On Add Your Application, set a name and input the domain on which your app will eventually be deployed. You can create multiple application in Keyri to account for your development, staging, and production environments\n\u200b\n",(0,a.kt)("img",{parentName:"p",src:"https://archbee-image-uploads.s3.amazonaws.com/FQ4YmCkDokMJylbTAsoOR/HvTIja3KfgKUIMiNVKAqP_screen-shot-2022-10-13-at-21524-pm.png",alt:null}),"\n\u200b\nNote your application key from the Keys and Credentials section - this will be used in the Mobile portion of the implementation\n\u200b\n",(0,a.kt)("img",{parentName:"p",src:"https://archbee-image-uploads.s3.amazonaws.com/FQ4YmCkDokMJylbTAsoOR/KnD6LkWs-PUDtTS1sT9Rz_screen-shot-2022-10-13-at-21746-pm.png",alt:null}),"\n\u200b"),(0,a.kt)("h1",{id:"web"},"Web"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://www.youtube.com/watch?v=jrjrcpc2PFQ",title:"Supabase & Keyri | Web Integration Overview"},(0,a.kt)("img",{parentName:"a",src:"http://img.youtube.com/vi/jrjrcpc2PFQ/0.jpg",alt:"Keyri-Supabase Web Integration Video"})),"\n\u200b\nFor your web app, first download KeyriQR.html (available ",(0,a.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/Keyri-Co/library-keyri-connect/main/KeyriQR.html"},"here"),") and save it to a public directory.\n\u200b\nNext, embed KeyriQR.html in your login page as an iFrame within the desired div. This serves as the widget that displays the dynamic QR code and connects with the Keyri API.\n\u200b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n    <iframe\n        title='KeyriQR'\n        src='/KeyriQR.html'\n        id='qr-frame'\n        height='300'\n        width='300'\n        scrolling='no'\n        style={{ border: 'solid 5px white' }}\n      ></iframe>\n</div>\n")),(0,a.kt)("p",null,"\u200b\nNext, for the same login view, set up an event listener to pick up the session token that the iFrame emits when the QR code is scanned by your app.\n\u200b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"useEffect(() => {\n    window.addEventListener('message', async (evt) => {\n      if (evt.data.keyri && evt.data.data && document.location.origin == evt.origin) {\n        const { data } = evt;\n        if (!data.error) {\n          let refresh_token = JSON.parse(data.data).refreshToken;\n          await handleQrLogin(refresh_token);\n        } else if (data.error) {\n          console.log(`Keyri error: ${data.message}`);\n        }\n      }\n});\n")),(0,a.kt)("p",null,"\u200b\nThat's it!\n\u200b"),(0,a.kt)("h1",{id:"mobile"},"Mobile"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://www.youtube.com/watch?v=oGMsSKyh6tc",title:"Supabase & Keyri | Mobile Integration Overview"},(0,a.kt)("img",{parentName:"a",src:"http://img.youtube.com/vi/oGMsSKyh6tc/0.jpg",alt:"Keyri-Supabase Mobile Integration Video"})),"\n\u200b"),(0,a.kt)("h3",{id:"install-flutter"},"Install Flutter"),(0,a.kt)("p",null,"\u200b\nFirst, install the Flutter SDK, found at flutter.dev\n\u200b\nMake sure to add Flutter to your PATH, for example:"," ","\n\u200b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'export PATH="$PATH:`pwd`/flutter/bin"\n')),(0,a.kt)("p",null,"\u200b"),(0,a.kt)("h3",{id:"apple---initial-setup"},"Apple - initial setup"),(0,a.kt)("p",null,"\u200b\nDownload the latest version of Xcode from the Mac App Store. Make sure the Xcode provided simulator is using a 64-bit device (iPhone 5s or later). You can check the device by viewing the settings in the simulator\u2019s ",(0,a.kt)("strong",{parentName:"p"},"Hardware > Device")," or ",(0,a.kt)("strong",{parentName:"p"},"File > Open Simulator")," menus.\n\u200b"),(0,a.kt)("h3",{id:"android---initial-setup"},"Android - initial setup"),(0,a.kt)("p",null,"\u200b\nDownload the latest version of ",(0,a.kt)("a",{parentName:"p",href:"https://developer.android.com/studio"},"Android Studio"),". Install Android SDK and needed emulator(s).\n\u200b"),(0,a.kt)("h3",{id:"create-project"},"Create Project"),(0,a.kt)("p",null,"\u200b\nRun this command in your terminal/shell at the desired location for your new project\n\u200b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ flutter create my_app\n")),(0,a.kt)("p",null,"\u200b\nYou can then CD into the new directory, and run the test app with"," ","\n\u200b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"flutter run\n")),(0,a.kt)("p",null,"\u200b\nThis is a good test - if things are configured correctly so far you should see the default Flutter test app deployed.\n\u200b"),(0,a.kt)("h3",{id:"add-dependencies-keyri-and-supabase"},"Add dependencies (Keyri and Supabase)"),(0,a.kt)("p",null,"\u200b\nOpen your Pubspec.yaml file, which should be at the top level directory in your new project\n\u200b\nAdd Keyri and Supabase under ",(0,a.kt)("strong",{parentName:"p"},"dependencies"),"\n\u200b\n",(0,a.kt)("img",{parentName:"p",src:"https://archbee-image-uploads.s3.amazonaws.com/FQ4YmCkDokMJylbTAsoOR/jlAfOTEchuZpBq8TeXhJZ_screen-shot-2022-09-29-at-060908.png",alt:null}),"\n\u200b\nOne can now access Supabase and Keyri sdks in their Flutter code\n\u200b"),(0,a.kt)("h3",{id:"utilize-the-two-together"},"Utilize the two together"),(0,a.kt)("p",null,"\u200b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Make a request to Supabase to authenticate the user\n\u200b"),(0,a.kt)("li",{parentName:"ol"},"Parse the response to extract the token\n\u200b"),(0,a.kt)("li",{parentName:"ol"},"Authenticate using Keyri",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"1.  Below, we show how to utilize the EasyKeyriAuth function, which takes the user through scanning the code, creating the session, displaying the confirmation screen, and finalizing the payload transmission\n    - Note - you can find your App Key in the Keyri Developer Portal\n")),"\u200b\n2.  Alternatively, intermediate functions in the Keyri SDK, discussed in the mobile docs, can provide control over displaying a custom QR Scanner and/or Confirmation screen\n\u200b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"// Sign in user with email and password\n// Alternatively one can utilize the Supabase API to accomplish the same thing\nfinal response = await client.auth.signIn(email: 'email', password: 'password');\n\u200b\nif (response.error != null) {\n  // Error\n    print('Error: ${response.error?.message}');\n} else {\n    // Success\n    final session = response.data;\n\u200b\n    // This is the payload that needs to be send through Keyri\n    final refreshToken = session.refreshToken\n\u200b\n    // EasyKeyriAuth guides the user through scanning and parsing the QR, confirming the session, and configuring the payload\n    // One can also use the initiateQRSession method to use the Keyri Scanner with a custom Confirmation screen\n    // Or the ProcessLink method if you have your own scanner or are using deep linking\n    await keyri\n        .easyKeyriAuth([App Key],\n            '{\"refreshToken\":\"$refreshToken\"}', [email])\n        .then((authResult) => _onAuthResult(authResult))\n        .catchError((error, stackTrace) => _onError(error));\n\u200b\n}\n\u200b\n\u200b\n")))}c.isMDXComponent=!0}}]);