"use strict";(self.webpackChunkreference_docs=self.webpackChunkreference_docs||[]).push([[79682],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>b});var r=t(67294);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function n(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?n(Object(t),!0).forEach((function(a){s(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function u(e,a){if(null==e)return{};var t,r,s=function(e,a){if(null==e)return{};var t,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var o=r.createContext({}),i=function(e){var a=r.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=i(e.components);return r.createElement(o.Provider,{value:a},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},m=r.forwardRef((function(e,a){var t=e.components,s=e.mdxType,n=e.originalType,o=e.parentName,p=u(e,["components","mdxType","originalType","parentName"]),d=i(t),m=s,b=d["".concat(o,".").concat(m)]||d[m]||c[m]||n;return t?r.createElement(b,l(l({ref:a},p),{},{components:t})):r.createElement(b,l({ref:a},p))}));function b(e,a){var t=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var n=t.length,l=new Array(n);l[0]=m;var u={};for(var o in a)hasOwnProperty.call(a,o)&&(u[o]=a[o]);u.originalType=e,u[d]="string"==typeof e?e:s,l[1]=u;for(var i=2;i<n;i++)l[i]=t[i];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},62238:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>u,metadata:()=>i,toc:()=>d});var r=t(87462),s=(t(67294),t(3905)),n=t(65488),l=t(85162);const u={id:"upgrade-guide",title:"Upgrade to supabase-js v2",description:"Learn how to upgrade to supabase-js v2."},o=void 0,i={unversionedId:"upgrade-guide",id:"upgrade-guide",title:"Upgrade to supabase-js v2",description:"Learn how to upgrade to supabase-js v2.",source:"@site/_supabase_js/upgrade-guide.mdx",sourceDirName:".",slug:"/upgrade-guide",permalink:"/docs/reference/javascript/upgrade-guide",draft:!1,editUrl:"https://github.com/_supabase_js/upgrade-guide.mdx",tags:[],version:"current",frontMatter:{id:"upgrade-guide",title:"Upgrade to supabase-js v2",description:"Learn how to upgrade to supabase-js v2."}},p={},d=[{value:"Upgrade the client library",id:"upgrade-the-client-library",level:2},{value:"Auth methods",id:"auth-methods",level:3},{value:"Sign in with email and password",id:"sign-in-with-email-and-password",level:4},{value:"Sign in with magic link",id:"sign-in-with-magic-link",level:4},{value:"Sign in with a third-party provider",id:"sign-in-with-a-third-party-provider",level:4},{value:"Sign in with phone",id:"sign-in-with-phone",level:4},{value:"Sign in with phone using OTP",id:"sign-in-with-phone-using-otp",level:4},{value:"Reset password for email",id:"reset-password-for-email",level:4},{value:"Get the user&#39;s current session",id:"get-the-users-current-session",level:4},{value:"Get the logged-in user",id:"get-the-logged-in-user",level:4},{value:"Update user data for a logged-in user",id:"update-user-data-for-a-logged-in-user",level:4},{value:"Use a custom <code>access_token</code> JWT with Supabase",id:"use-a-custom-access_token-jwt-with-supabase",level:4},{value:"Data methods",id:"data-methods",level:3},{value:"Insert and return data",id:"insert-and-return-data",level:4},{value:"Update and return data",id:"update-and-return-data",level:4},{value:"Realtime methods",id:"realtime-methods",level:3},{value:"Subscribe",id:"subscribe",level:4},{value:"Unsubscribe",id:"unsubscribe",level:4}],c={toc:d};function m(e){let{components:a,...t}=e;return(0,s.kt)("wrapper",(0,r.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("p",null,'supabase-js v2 focuses on "quality-of-life" improvements for developers and addresses some of the largest pain points in v1. v2 includes type support, a rebuilt Auth library with async methods, improved errors, and more.'),(0,s.kt)("p",null,"No new features will be added to supabase-js v1 , but we'll continuing merging security fixes to v1, with maintenance patches for the next 3 months."),(0,s.kt)("h2",{id:"upgrade-the-client-library"},"Upgrade the client library"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sh"},"npm install @supabase/supabase-js@2\n")),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"Optionally")," if you are using custom configuration with ",(0,s.kt)("inlineCode",{parentName:"p"},"createClient")," then follow below:"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/supabaseClient.ts"',title:'"src/supabaseClient.ts"'},"const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n  schema: 'custom',\n  persistSession: false\n})\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/supabaseClient.ts"',title:'"src/supabaseClient.ts"'},"const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n  db: {\n    schema: 'custom'\n  },\n  auth: {\n    persistSession: true\n  }\n})\n")))),(0,s.kt)("p",null,"Read more about the ",(0,s.kt)("a",{parentName:"p",href:"/docs/reference/javascript/release-notes#explicit-constructor-options"},"constructor options"),"."),(0,s.kt)("h3",{id:"auth-methods"},"Auth methods"),(0,s.kt)("p",null,"The signIn() method has been deprecated in favor of more explicit method signatures to help with type hinting. Previously it was difficult for developers to know what they were missing (e.g., a lot of developers didn't realize they could use passwordless magic links)."),(0,s.kt)("h4",{id:"sign-in-with-email-and-password"},"Sign in with email and password"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { user, error } = await supabase.auth.signIn({ email, password })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data: { user }, error } = await supabase.auth.signInWithPassword({ email, password })\n")))),(0,s.kt)("h4",{id:"sign-in-with-magic-link"},"Sign in with magic link"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signIn({ email })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signInWithOtp({ email })\n")))),(0,s.kt)("h4",{id:"sign-in-with-a-third-party-provider"},"Sign in with a third-party provider"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signIn({ provider })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signInWithOAuth({ provider })\n")))),(0,s.kt)("h4",{id:"sign-in-with-phone"},"Sign in with phone"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signIn({ phone, password })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.signInWithPassword({ phone, password })\n")))),(0,s.kt)("h4",{id:"sign-in-with-phone-using-otp"},"Sign in with phone using OTP"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { error } = await supabase.auth.api.sendMobileOTP(phone)\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.signInWithOtp({ phone })\n\n// After receiving a SMS with a OTP.\nconst { data, error } = await supabase.auth.verifyOtp({ phone, token })\n")))),(0,s.kt)("h4",{id:"reset-password-for-email"},"Reset password for email"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.api.resetPasswordForEmail(email)\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.resetPasswordForEmail(email)\n")))),(0,s.kt)("h4",{id:"get-the-users-current-session"},"Get the user's current session"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const session = supabase.auth.session()\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data: { session } } = await supabase.auth.getSession()\n")))),(0,s.kt)("h4",{id:"get-the-logged-in-user"},"Get the logged-in user"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const user = supabase.auth.user()\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data: { session } } = await supabase.auth.getSession()\nconst { user } = session\n")))),(0,s.kt)("h4",{id:"update-user-data-for-a-logged-in-user"},"Update user data for a logged-in user"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { user, error } = await supabase.auth.update({ attributes })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data: { user }, error } = await supabase.auth.updateUser({ attributes })\n")))),(0,s.kt)("h4",{id:"use-a-custom-access_token-jwt-with-supabase"},"Use a custom ",(0,s.kt)("inlineCode",{parentName:"h4"},"access_token")," JWT with Supabase"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { user, error } = supabase.auth.setAuth(access_token)\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n  global: { \n    headers: {\n      Authorization: `Bearer ${access_token}`\n    }\n  }\n})\n")))),(0,s.kt)("h3",{id:"data-methods"},"Data methods"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},".insert()")," / ",(0,s.kt)("inlineCode",{parentName:"p"},".upsert()")," / ",(0,s.kt)("inlineCode",{parentName:"p"},".update()")," / ",(0,s.kt)("inlineCode",{parentName:"p"},".delete()")," don't return rows by default: ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/supabase/postgrest-js/pull/276"},"PR"),"."),(0,s.kt)("p",null,"Previously, these methods return inserted/updated/deleted rows by default (which caused ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/supabase/supabase/discussions/1548"},"some confusion"),"), and you can opt to not return it by specifying ",(0,s.kt)("inlineCode",{parentName:"p"},"returning: 'minimal'"),". Now the default behavior is to not return rows. To return inserted/updated/deleted rows, add a ",(0,s.kt)("inlineCode",{parentName:"p"},".select()")," call at the end."),(0,s.kt)("h4",{id:"insert-and-return-data"},"Insert and return data"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.insert({ new_data })\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.insert({ new_data }).select()\n")))),(0,s.kt)("h4",{id:"update-and-return-data"},"Update and return data"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.update({ new_data }).eq('id', id)\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const { data, error } = await supabase.auth.update({ new_data }).eq('id', id).select()\n")))),(0,s.kt)("h3",{id:"realtime-methods"},"Realtime methods"),(0,s.kt)("h4",{id:"subscribe"},"Subscribe"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const userListener = supabase.from('users')\n  .on('*', \n    (payload) => handleAllEventsPayload(payload.new)\n  )\n  .subscribe()\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"const userListener = supabase.channel('public:user')\n  .on(\n    'postgres_changes',\n    { event: '*', schema: 'public', table: 'user' }\n    (payload) => handleAllEventsPayload()\n  )\n  .subscribe()\n")))),(0,s.kt)("h4",{id:"unsubscribe"},"Unsubscribe"),(0,s.kt)(n.Z,{groupId:"version",values:[{label:"Before",value:"1.x"},{label:"After",value:"2.x"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"1.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"userListener.unsubscribe()\n"))),(0,s.kt)(l.Z,{value:"2.x",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"supabase.removeChannel('public:users')\n")))))}m.isMDXComponent=!0},85162:(e,a,t)=>{t.d(a,{Z:()=>l});var r=t(67294),s=t(86010);const n="tabItem_Ymn6";function l(e){let{children:a,hidden:t,className:l}=e;return r.createElement("div",{role:"tabpanel",className:(0,s.Z)(n,l),hidden:t},a)}},65488:(e,a,t)=>{t.d(a,{Z:()=>m});var r=t(87462),s=t(67294),n=t(86010),l=t(72389),u=t(67392),o=t(7094),i=t(12466);const p="tabList__CuJ",d="tabItem_LNqP";function c(e){const{lazy:a,block:t,defaultValue:l,values:c,groupId:m,className:b}=e,g=s.Children.map(e.children,(e=>{if((0,s.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),v=c??g.map((e=>{let{props:{value:a,label:t,attributes:r}}=e;return{value:a,label:t,attributes:r}})),h=(0,u.l)(v,((e,a)=>e.value===a.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const k=null===l?l:l??g.find((e=>e.props.default))?.props.value??g[0].props.value;if(null!==k&&!v.some((e=>e.value===k)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${k}" but none of its children has the corresponding value. Available values are: ${v.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:f,setTabGroupChoices:x}=(0,o.U)(),[y,w]=(0,s.useState)(k),T=[],{blockElementScrollPositionUntilNextRender:N}=(0,i.o5)();if(null!=m){const e=f[m];null!=e&&e!==y&&v.some((a=>a.value===e))&&w(e)}const I=e=>{const a=e.currentTarget,t=T.indexOf(a),r=v[t].value;r!==y&&(N(a),w(r),null!=m&&x(m,String(r)))},Z=e=>{let a=null;switch(e.key){case"Enter":I(e);break;case"ArrowRight":{const t=T.indexOf(e.currentTarget)+1;a=T[t]??T[0];break}case"ArrowLeft":{const t=T.indexOf(e.currentTarget)-1;a=T[t]??T[T.length-1];break}}a?.focus()};return s.createElement("div",{className:(0,n.Z)("tabs-container",p)},s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.Z)("tabs",{"tabs--block":t},b)},v.map((e=>{let{value:a,label:t,attributes:l}=e;return s.createElement("li",(0,r.Z)({role:"tab",tabIndex:y===a?0:-1,"aria-selected":y===a,key:a,ref:e=>T.push(e),onKeyDown:Z,onClick:I},l,{className:(0,n.Z)("tabs__item",d,l?.className,{"tabs__item--active":y===a})}),t??a)}))),a?(0,s.cloneElement)(g.filter((e=>e.props.value===y))[0],{className:"margin-top--md"}):s.createElement("div",{className:"margin-top--md"},g.map(((e,a)=>(0,s.cloneElement)(e,{key:a,hidden:e.props.value!==y})))))}function m(e){const a=(0,l.Z)();return s.createElement(c,(0,r.Z)({key:String(a)},e))}}}]);