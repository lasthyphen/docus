"use strict";(self.webpackChunkreference_docs=self.webpackChunkreference_docs||[]).push([[78521],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),u=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},l=function(e){var t=u(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),d=u(a),g=r,h=d["".concat(p,".").concat(g)]||d[g]||c[g]||s;return a?n.createElement(h,o(o({ref:t},l),{},{components:a})):n.createElement(h,o({ref:t},l))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,o=new Array(s);o[0]=g;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[d]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<s;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},257:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const s={id:"pgmustard",title:"pgMustard",description:"Troubleshoot slow queries on Supabase with pgMustard, a visualization tool that also gives advice."},o=void 0,i={unversionedId:"guides/integrations/pgmustard",id:"guides/integrations/pgmustard",title:"pgMustard",description:"Troubleshoot slow queries on Supabase with pgMustard, a visualization tool that also gives advice.",source:"@site/docs/guides/integrations/pgmustard.mdx",sourceDirName:"guides/integrations",slug:"/guides/integrations/pgmustard",permalink:"/docs/guides/integrations/pgmustard",draft:!1,editUrl:"https://github.com/docs/guides/integrations/pgmustard.mdx",tags:[],version:"current",frontMatter:{id:"pgmustard",title:"pgMustard",description:"Troubleshoot slow queries on Supabase with pgMustard, a visualization tool that also gives advice."}},p={},u=[{value:"Step 1: Get the query plan from Supabase",id:"step-1-get-the-query-plan-from-supabase",level:2},{value:"Step 2: Paste the query plan into pgMustard",id:"step-2-paste-the-query-plan-into-pgmustard",level:2},{value:"Step 3: Look through the top tips and slowest operations",id:"step-3-look-through-the-top-tips-and-slowest-operations",level:2},{value:"Step 4: Consider your options",id:"step-4-consider-your-options",level:2},{value:"Resources",id:"resources",level:2}],l={toc:u};function d(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide explains how to troubleshoot slow queries on Supabase using ",(0,r.kt)("inlineCode",{parentName:"p"},"explain")," and pgMustard."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pgmustard.com/"},"pgMustard")," is a visualization tool for ",(0,r.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/using-explain.html#USING-EXPLAIN-ANALYZE"},(0,r.kt)("inlineCode",{parentName:"a"},"explain analyze"))," that also gives performance tips."),(0,r.kt)("h2",{id:"step-1-get-the-query-plan-from-supabase"},"Step 1: Get the query plan from Supabase"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"explain analyze")," to get a query plan from Postgres. This will run the query behind the scenes, so be careful with data modification queries."),(0,r.kt)("p",null,"pgMustard requires plans to be in json format, and the buffers, verbose, and settings parameters allow it to give better tips."),(0,r.kt)("p",null,"So a good prefix for your query would be:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"explain (analyze, format json, buffers, verbose, settings)\n")),(0,r.kt)("p",null,"Run the query, and copy the output."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"01-supabase-run-query",src:a(98751).Z,width:"1920",height:"1280"})),(0,r.kt)("p",null,"If you\u2019re using the Supabase SQL Editor, this is easily copied from the cell titled ",(0,r.kt)("inlineCode",{parentName:"p"},"QUERY PLAN"),", as seen above."),(0,r.kt)("p",null,"If you have any trouble, check out pgMustard\u2019s guide for ",(0,r.kt)("a",{parentName:"p",href:"https://www.pgmustard.com/getting-a-query-plan"},"getting a query plan"),"."),(0,r.kt)("h2",{id:"step-2-paste-the-query-plan-into-pgmustard"},"Step 2: Paste the query plan into pgMustard"),(0,r.kt)("p",null,"Paste the json output into pgMustard and press Submit."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"02-paste-plan-pgmustard",src:a(61739).Z,width:"2880",height:"1650"})),(0,r.kt)("h2",{id:"step-3-look-through-the-top-tips-and-slowest-operations"},"Step 3: Look through the top tips and slowest operations"),(0,r.kt)("p",null,"Review the top tips in pgMustard. These are scored on a scale of 0 to 5 stars, based on how much time-saving potential they have (5 stars meaning lots of potential)."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-review-tips-pgmustard",src:a(66655).Z,width:"1999",height:"1288"})),(0,r.kt)("p",null,"Click one of the tips, or one of the operations, to see more information."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"04-click-tip-pgmustard",src:a(16594).Z,width:"1999",height:"1131"})),(0,r.kt)("h2",{id:"step-4-consider-your-options"},"Step 4: Consider your options"),(0,r.kt)("p",null,"If you get some promising suggestions, you may wish to explore them."),(0,r.kt)("p",null,"If you don\u2019t get any tips, your query might be quite fast for the amount of work it\u2019s doing."),(0,r.kt)("p",null,"For the example we saw in Step 3, let's try adding an index on the ",(0,r.kt)("inlineCode",{parentName:"p"},"customer_name")," field in Supabase."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"05-create-index-supabase",src:a(72272).Z,width:"1920",height:"1280"})),(0,r.kt)("p",null,"Going through Steps 1-3 again, we now get an efficient index scan, that will scale nicely as our data grows."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"06-check-pgmustard",src:a(87654).Z,width:"1999",height:"1288"})),(0,r.kt)("p",null,"We could look into why Postgres isn\u2019t choosing to do an index-only scan here, but pgMustard is letting us know that it doesn\u2019t think we\u2019ll gain much by doing so, by scoring the tip 0.3 out of 5."),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.pgmustard.com"},"pgMustard")," official website."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.pgmustard.com/docs/explain"},"pgMustard explain glossary"),".")))}d.isMDXComponent=!0},98751:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/01-supabase-run-query-3cb6d49cb2751819215094bac7a5b986.png"},61739:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/02-paste-plan-pgmustard-11d3f5196a2c264342d5c33c469c486e.png"},66655:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/03-review-tips-pgmustard-e684ec3f7e9e93f91645cc6275912b9d.png"},16594:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/04-click-tip-pgmustard-da88aadfdb1327e3bb9cecd79753eb4f.png"},72272:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/05-create-index-supabase-390b0edee03cf35721d9ccd2bc332ea2.png"},87654:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/06-check-pgmustard-e51a60f8f4d9f49f5dfae0ba9ac09fa2.png"}}]);