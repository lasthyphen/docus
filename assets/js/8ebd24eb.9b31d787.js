"use strict";(self.webpackChunkreference_docs=self.webpackChunkreference_docs||[]).push([[1092],{43072:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>w,contentTitle:()=>f,default:()=>E,frontMatter:()=>v,metadata:()=>y,toc:()=>N});var n=a(87462),s=a(67294),i=a(3905),o=a(31166),r=a(90814);function l(e){let{header:t,code:a,highlight:n,js:i,jsHighlight:o,response:l,language:d}=e;const[p,c]=(0,s.useState)(!1);let h="";return t&&(h+=" code-with-header"),l&&(h+=" code-with-response"),s.createElement(s.Fragment,null,s.createElement("div",{className:h},t&&s.createElement("div",{className:"code-header"},t),s.createElement(s.Fragment,null,a&&s.createElement(r.Z,{className:d||"bash",metastring:n},a),i&&s.createElement(r.Z,{metastring:o},i))),l&&s.createElement(s.Fragment,null,s.createElement("div",{className:"code-with-header repsonse-header"},s.createElement("a",{className:"code-header has-hover-pointer",style:p?u.responseShown:u.responseHidden,onClick:()=>c(!p)},p?"Hide":"Show"," Response"),p&&s.createElement(r.Z,null,l))))}const u={responseShown:{textAlign:"right",display:"block",borderRadius:"0",color:"var(--custom-primary)",borderTop:"1px solid #444"},responseHidden:{textAlign:"right",display:"block",borderBottom:"none",borderRadius:"0 0 4px 4px",borderTop:"1px solid #444",color:"#ccc"}},d={alg:"HS256",typ:"JWT"},p=new Date,c=new Date(p.getFullYear(),p.getMonth(),p.getDate()),h=new Date(p.getFullYear()+5,p.getMonth(),p.getDate()),m=`\n{\n    "role": "anon",\n    "iss": "supabase",\n    "iat": ${Math.floor(c/1e3)},\n    "exp": ${Math.floor(h/1e3)}\n}\n`.trim(),g=`\n{\n    "role": "service_role",\n    "iss": "supabase",\n    "iat": ${Math.floor(c/1e3)},\n    "exp": ${Math.floor(h/1e3)}\n}\n`.trim();function k(e){let{}=e;const t=[...Array(40)].map((()=>Math.random().toString(36)[2])).join(""),[a,n]=(0,s.useState)(t),[i,r]=(0,s.useState)(m),[u,p]=(0,s.useState)("");return s.createElement("div",null,s.createElement("div",{style:b.inputContainer},s.createElement("label",null,"JWT Secret:"),s.createElement("input",{type:"text",style:b.input,placeholder:"JWT Secret (at least 32 characters)",value:a,onChange:e=>n(e.target.value)})),s.createElement("div",{style:b.inputContainer},s.createElement("label",null,"Preconfigured Payload:"),s.createElement("select",{onChange:e=>{const t=e.target.value;r("service"==t?g:m)},style:b.input},s.createElement("option",{value:"anon"},"ANON_KEY"),s.createElement("option",{value:"service"},"SERVICE_KEY"))),s.createElement("div",{style:b.inputContainer},s.createElement("label",null,"Payload:"),s.createElement("textarea",{type:"text",style:b.input,rows:"5",placeholder:"A valid JWT Token",value:i,onChange:e=>r(e.target.value)})),s.createElement("button",{className:"button button--primary",onClick:()=>{const e=o.dQ.JWS.sign(null,d,i,a);p(e)}},"Generate JWT"),u&&s.createElement("div",{style:{marginTop:20}},s.createElement("h4",null,"Generated Token"),s.createElement(l,{code:u})))}const b={inputContainer:{marginBottom:"15px"},input:{border:"1px solid var(--ifm-panel-border-color)",borderRadius:4,backgroundColor:"var(--custom-background-color-diff)",color:"var(--ifm-font-color-base)",margin:0,padding:"6px 8px",width:"100%"},card:{border:"1px solid var(--ifm-panel-border-color)",borderRadius:5,padding:8},title:{margin:0,fontSize:"0.9rem",border:"1px solid var(--ifm-panel-border-color)"},description:{fontSize:"0.8rem",margin:0}},v={id:"overview",title:"Self Hosting",sidebar_label:"Overview",description:"Getting started with Self Hosting."},f=void 0,y={unversionedId:"guides/hosting/overview",id:"guides/hosting/overview",title:"Self Hosting",description:"Getting started with Self Hosting.",source:"@site/docs/guides/hosting/overview.mdx",sourceDirName:"guides/hosting",slug:"/guides/hosting/overview",permalink:"/docs/guides/hosting/overview",draft:!1,editUrl:"https://github.com/docs/guides/hosting/overview.mdx",tags:[],version:"current",frontMatter:{id:"overview",title:"Self Hosting",sidebar_label:"Overview",description:"Getting started with Self Hosting."}},w={},N=[{value:"Architecture",id:"architecture",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Managing your database",id:"managing-your-database",level:2},{value:"Database Extensions",id:"database-extensions",level:3},{value:"<code>uuid-ossp</code>",id:"uuid-ossp",level:5},{value:"<code>pgcrypto</code> and <code>pgjwt</code>",id:"pgcrypto-and-pgjwt",level:5},{value:"Database Roles",id:"database-roles",level:3},{value:"<code>postgres</code>",id:"postgres",level:5},{value:"<code>anon</code>",id:"anon",level:5},{value:"<code>authenticator</code>",id:"authenticator",level:5},{value:"<code>authenticated</code>",id:"authenticated",level:5},{value:"<code>service_role</code>",id:"service_role",level:5},{value:"<code>supabase_auth_admin</code>",id:"supabase_auth_admin",level:5},{value:"<code>supabase_storage_admin</code>",id:"supabase_storage_admin",level:5},{value:"<code>dashboard_user</code>",id:"dashboard_user",level:5},{value:"<code>supabase_admin</code>",id:"supabase_admin",level:5},{value:"API Keys",id:"api-keys",level:2},{value:"Managing your secrets",id:"managing-your-secrets",level:2},{value:"Migrating and Upgrading",id:"migrating-and-upgrading",level:2},{value:"Deployment options",id:"deployment-options",level:2}],S={toc:N};function E(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,n.Z)({},S,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"There are several ways to use Supabase:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://app.supabase.com"},"Supabase Cloud"),": you don't need to deploy anything. We will manage and scale your infrastructure."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../../guides/hosting/docker"},"Docker"),": deploy to your own infrastructure."),(0,i.kt)("li",{parentName:"ul"},"Kubernetes: coming soon.")),(0,i.kt)("h2",{id:"architecture"},"Architecture"),(0,i.kt)("p",null,"Supabase is a combination of open source tools, each specifically chosen for Enterprise-readiness."),(0,i.kt)("p",null,"If the tools and communities already exist, with an MIT, Apache 2, or equivalent open license, we will use and support that tool.\nIf the tool doesn't exist, we build and open source it ourselves."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Supabase Architecture",src:a(16245).Z,width:"1858",height:"829"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/Kong/kong"},"Kong")," is a cloud-native API gateway."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/netlify/gotrue"},"GoTrue")," is an SWT based API for managing users and issuing SWT tokens."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://postgrest.org/"},"PostgREST")," is a web server that turns your PostgreSQL database directly into a RESTful API"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/realtime"},"Realtime")," is an Elixir server that allows you to listen to PostgreSQL inserts, updates, and deletes using websockets. Realtime polls Postgres' built-in replication functionality for database changes, converts changes to JSON, then broadcasts the JSON over websockets to authorized clients."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/storage-api"},"Storage")," provides a RESTful interface for managing Files stored in S3, using Postgres to manage permissions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/postgres-meta"},"postgres-meta")," is a RESTful API for managing your Postgres, allowing you to fetch tables, add roles, and run queries, etc."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.postgresql.org/"},"PostgreSQL")," is an object-relational database system with over 30 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.")),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"Each system has a number of configuration options which can be found in the relevant product documentation."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/postgres/"},"Postgres")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://postgrest.org/en/stable/configuration.html"},"PostgREST")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/realtime#server-set-up"},"Realtime")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/gotrue"},"GoTrue")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase/storage-api"},"Storage")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.konghq.com/install/docker/"},"Kong"))),(0,i.kt)("h2",{id:"managing-your-database"},"Managing your database"),(0,i.kt)("p",null,'It is recommended that you decouple your database from the middleware so that you can upgrade the middleware without any downtime.\nThe "middleware" is everything except Postgres, and it should work with any Postgres provider (such as AWS RDS), or your own Postgres cluster.'),(0,i.kt)("h3",{id:"database-extensions"},"Database Extensions"),(0,i.kt)("p",null,"Supabase requires some Postgres extensions to be enabled by default for the API and Auth system to work. You can find the extensions inside the\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/supabase/supabase/blob/master/docker/volumes/db/init/00-initial-schema.sql"},"schema initialization script"),"."),(0,i.kt)("p",null,"We recommend installing all extensions into an ",(0,i.kt)("inlineCode",{parentName:"p"},"extensions")," schema. This will keep your API clean,\nsince all tables in the ",(0,i.kt)("inlineCode",{parentName:"p"},"public")," schema are exposed via the API."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},'create schema if not exists extensions;\ncreate extension if not exists "uuid-ossp" with schema extensions;\ncreate extension if not exists pgcrypto with schema extensions;\ncreate extension if not exists pgjwt with schema extensions;\n')),(0,i.kt)("h5",{id:"uuid-ossp"},(0,i.kt)("inlineCode",{parentName:"h5"},"uuid-ossp")),(0,i.kt)("p",null,"For UUID functions, required for PostgreSQL <13."),(0,i.kt)("h5",{id:"pgcrypto-and-pgjwt"},(0,i.kt)("inlineCode",{parentName:"h5"},"pgcrypto")," and ",(0,i.kt)("inlineCode",{parentName:"h5"},"pgjwt")),(0,i.kt)("p",null,"For working with JWT and Auth functions."),(0,i.kt)("h3",{id:"database-roles"},"Database Roles"),(0,i.kt)("p",null,"Supabase creates several default roles in your Postgres database. To restore defaults at any time you can run the commands inside the\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/supabase/supabase/blob/master/docker/volumes/db/init/00-initial-schema.sql"},"schema initialization script"),"."),(0,i.kt)("h5",{id:"postgres"},(0,i.kt)("inlineCode",{parentName:"h5"},"postgres")),(0,i.kt)("p",null,"The default PostgreSQL role. This has admin privileges."),(0,i.kt)("h5",{id:"anon"},(0,i.kt)("inlineCode",{parentName:"h5"},"anon")),(0,i.kt)("p",null,'For "anonymous access". This is the role which the API (PostgREST) will use when a user ',(0,i.kt)("em",{parentName:"p"},"is not")," logged in."),(0,i.kt)("h5",{id:"authenticator"},(0,i.kt)("inlineCode",{parentName:"h5"},"authenticator")),(0,i.kt)("p",null,'A special role for the API (PostgREST). It has very limited access, and is used to validate a JWT and then\n"change into" another role determined by the JWT verification.'),(0,i.kt)("h5",{id:"authenticated"},(0,i.kt)("inlineCode",{parentName:"h5"},"authenticated")),(0,i.kt)("p",null,'For "authenticated access". This is the role which the API (PostgREST) will use when a user ',(0,i.kt)("em",{parentName:"p"},"is")," logged in."),(0,i.kt)("h5",{id:"service_role"},(0,i.kt)("inlineCode",{parentName:"h5"},"service_role")),(0,i.kt)("p",null,"For elevated access. This role is used by the API (PostgREST) to bypass Row Level Security."),(0,i.kt)("h5",{id:"supabase_auth_admin"},(0,i.kt)("inlineCode",{parentName:"h5"},"supabase_auth_admin")),(0,i.kt)("p",null,"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the ",(0,i.kt)("inlineCode",{parentName:"p"},"auth")," schema."),(0,i.kt)("h5",{id:"supabase_storage_admin"},(0,i.kt)("inlineCode",{parentName:"h5"},"supabase_storage_admin")),(0,i.kt)("p",null,"Used by the Auth middleware to connect to the database and run migration. Access is scoped to the ",(0,i.kt)("inlineCode",{parentName:"p"},"storage")," schema."),(0,i.kt)("h5",{id:"dashboard_user"},(0,i.kt)("inlineCode",{parentName:"h5"},"dashboard_user")),(0,i.kt)("p",null,"For running commands via the Supabase UI."),(0,i.kt)("h5",{id:"supabase_admin"},(0,i.kt)("inlineCode",{parentName:"h5"},"supabase_admin")),(0,i.kt)("p",null,"Supabase Administrative role for maintaining your database."),(0,i.kt)("h2",{id:"api-keys"},"API Keys"),(0,i.kt)("p",null,"The API Gateway (Kong) uses JWT to authenticate access through to the database. The JWT should correspond to a relevant Postgres Role,\nand Supabase is designed to work with 2 roles: an ",(0,i.kt)("inlineCode",{parentName:"p"},"ANON_KEY")," for unauthenticated access and a ",(0,i.kt)("inlineCode",{parentName:"p"},"SERVICE_KEY")," for elevated access."),(0,i.kt)("p",null,"Use this tool to generate keys:"),(0,i.kt)(k,{mdxType:"JwtGenerator"}),(0,i.kt)("h2",{id:"managing-your-secrets"},"Managing your secrets"),(0,i.kt)("p",null,"Many components inside Supabase use secure secrets and passwords. These are listed in the self-hosting\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/supabase/supabase/blob/master/docker/.env.example"},"env file"),", but we strongly recommend using a\nsecrets manager when deploying to production. Plain text files like dotenv lead to accidental costly leaks."),(0,i.kt)("p",null,"Some suggested systems include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.doppler.com/"},"Doppler")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/key-vault/general/overview"},"Key Vault")," by Azure"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/secrets-manager/"},"Secrets Manager")," by AWS"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://cloud.google.com/secret-manager"},"Secrets Manager")," by GCP"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.hashicorp.com/products/vault"},"Vault")," by Hashicorp")),(0,i.kt)("h2",{id:"migrating-and-upgrading"},"Migrating and Upgrading"),(0,i.kt)("p",null,"If you have decoupled your database from the middleware, then you should be able to redeploy the latest middleware at any time as long as it has no breaking changes.\nSupabase is evolving fast, and we'll continue to improve the migration strategy as part of our core offering."),(0,i.kt)("p",null,"We realize that database migrations are difficult, and this is one of the problems we plan to make easy for developers."),(0,i.kt)("h2",{id:"deployment-options"},"Deployment options"),(0,i.kt)("p",null,"While Supabase officially supports Docker, we have several other deployment strategies managed by the community:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../../guides/hosting/docker"},"supabase-docker")," (Official)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase-community/supabase-kubernetes"},"supabase-kubernetes")," (Unofficial)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase-community/supabase-terraform"},"supabase-terraform")," (Unofficial)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/supabase-community/supabase-traefik"},"supabase-traefik")," (Unofficial)")))}E.isMDXComponent=!0},16245:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/supabase-architecture-0add114e10ee4902eac89403cf5488c8.png"}}]);